"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createServer = void 0;
const micro_1 = __importDefault(require("micro"));
const router_1 = require("@lightjs/router");
const config_1 = require("@lightjs/config");
function createServer({ middleware } = {}) {
    // Import the light config so that if the user has any one-off scripts defined, they will execute
    (0, config_1.importLightConfig)();
    const { router, reload, importedRoutes } = (0, router_1.createRouter)({ middleware });
    // create the http server
    const server = (0, micro_1.default)(async (req, res) => router.lookup(req, res));
    return {
        router,
        importedRoutes,
        reload,
        server,
    };
}
exports.createServer = createServer;
