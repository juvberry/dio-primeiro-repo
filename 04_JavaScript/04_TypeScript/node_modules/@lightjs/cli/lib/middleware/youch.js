"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.youchMiddleware = void 0;
const logger_1 = require("@lightjs/logger");
const youch_1 = __importDefault(require("youch"));
const youch_terminal_1 = __importDefault(require("youch-terminal"));
const logger = (0, logger_1.useFrameworkLogger)();
function youchMiddleware(fun) {
    return async function youchHandler(ctx) {
        try {
            // eslint-disable-next-line @typescript-eslint/return-await
            return await fun(ctx);
        }
        catch (err) {
            const youch = new youch_1.default(err, ctx.req);
            const json = await youch.toJSON();
            logger.info((0, youch_terminal_1.default)(json)); // eslint-disable-line
            return youch.toHTML();
        }
    };
}
exports.youchMiddleware = youchMiddleware;
